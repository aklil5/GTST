
# Malware Threats ðŸ”¥
Created on: 

Topics:
- Whats is
- kinds of
- Infection techniques
- Anti-virus (AV) softwares
- Malware in History
- Python for malware dev
- Malware Analysis
- Malware Analysis Techniques


----
# What is Malware
- A malware is a set of instruction (program) that run on your computer and make ur system do something that an attacker wants it to do
- The name Malware comes from
	- Malicious -> bad thing
	- Softwaare => set of instruction (program)
		- Mal - ware


## What malwares do?
1. Removing data/files
2. Encrypting data/files
3. Corrupting data/files
4. Stealing data/files
5. Spying on user

## Kinds of Malwares
- Based on their propagation/infection and attack, there are many kinds of malwares.
	1. Trojan
	2. Worm
	3. Virus
	4. Ransomeware
	5. Rootkit
	6. Adware
	7. ...


---
## TROJAN!
- Trojan, is a type of malicious code or software that looks [legitimate] but can control your computer.
- A Trojan is designed to damage, disrupt, steal or in general inflict some other harmful action on your data or network.
- They don't [replicate].
- The name Trojan came from the Greek mythology Trojan Horse.
- Trojans look normal or legit software and then BOOM!

### Greek Mythoology
- It described how Greek soldiers were able to take the city of Troy after fruitless ten-year siege by Giving Gift of giant horse by hiding soldiers inside of it, And then soldiers came out at night and evade the city of Troy.

## Common  types of 
1. Backdoor Trojan
	-  The Trojan can create a "back door" on your computer. It lets an attacker access your computer and control it. Your data can be downloaded by a third party and stolen. Or more malware can be uploaded to your device.
2. Mail-finder Trojan
	- This Trojan seeks to steal the email addresses you've accumulated on your device.
3. Remote Access Trojan (RAT)
	- This Trojan can give an attacker full control over your computer via a remote network connection. Its uses include stealing your information or spying on you.
		- C2 Servers (Command and Control)" this is a server which the malware communicate with, to pass commands to the malware also to have control over the malware to send and receive data.
4. Trojan banker
	- This trojan takes aim at your financial accounts. It's designed to steal your account information for all the things you do online. That includes banking, credit card, and bill pay data.


----
## Worm
- A computer worn can propagate or [self-replicate] from one computer to another without human interaction after breaching a system.
- Typically, a worm spreads across a network through your LAN (Local Area Network) connection.
- Damage files on the system including the system.


----
## Virus
- They are the older and famous ones
- Virus is a program written to get to your computer and damage/alter your files/data.
- A virus might corrupt or delete data on your computer.
- A virus can also [replicate] themselves.
- A computer Virus is more dangerous makes changes or deletes your files.

## Common signs of virus infection
- Speed of System
- Pop-up windows
- Self-executing
- Account being log out
- Crashing of device
- Mass email being sent from you
- Files and system settings are altered.

## Common types of virus
- There are several types of computer virus that can infect devices
1. Resident Virus
	- viruses propagate them selves by [infecting applications on a host computer]. A resident virus achieves this by infecting [applications are they are opened] by a user.
		- A non-resident virus is capable of infecting executable files when programs are [not running].
2. Multiple Virus
	- A multipartite virus uses multiple methods to infect and spread across computers. It will typically remain in the computer's memory to infect the hard disk, then spread through and infect more drives by altering the content of applications. This results in performance lag and application memory running low.
3. Browser Hijacker
	- A browser hijacker manually changes the settings of web browser, such as replacing the homepage, editing the new tab page, and changing the default search engine. Technically, it is not a virus because it cannot infect files.

----
## Ransomware
- Ransomware is malware that employs encryption to hold a victim's information at ransom.
- A user or organization's critical data is encrypted so that they cannot access files, databases, or applications.
- A ransom is then demanded to provide access.
- Ransomware is often designed to spread across a network and target database and file servers, and can thus quickly paralyze an entire organization.
- Ransomware => [RANSOM] + SOFT[WARE]


----
## Rootkit
- A rootkit is a type of malicious software designed to gain [unauthorized root or administrator-level access] to a computer system while concealing its presence and the presence of other malware.
- Rootkits allow attackers to maintain [persistent control] over a system, evade detection by security software, and perform various malicious activities.


----
## Adware
- Adware, or advertising supported software, is **software that displays unwanted advertisements on your computer.**
- Adware programs will tend to serve you pop-up ads, can change your browser's homepage, add spyware and just bombard your device with advertisements.


----
## Botnet
- Network of Bots
- A type of malware that infects multiple devices (often called **bots** or **zombies**), enabling a hacker (known as botmaster) to control those devices remotely from a single command-and-control server.
- These infected devices can be computers, servers, IoT device, or smartphones.
- Botnets are typically used for malicious activities such as launching distributed denial-of-service (DDoS) attacks, sending spam emails, stealing data, or performing other cyber-crimes.


----
# Infection techniques
- USB drop attack (infected removable drives)
	- hackers drop them around your company and when you plug it, BOOM!




----
# Malicious Office macros
- MACRO VIRUSES

---
- Softwares/Applications from unsafe websites.
	- Torrent sites
![[Pasted image 20250712211214.png]]

- Using Cracked Softwares
- Malicious Browser extension

----
# Anti-Virus (AV) Softwares
- Antivirus software is a security tool designed to detect, prevent and remove malicious software (Malware) such as viruses, worms, Trojans, ransomware, and more.
- The Antivirus Used Different Method to detect the Malware:
	- Signature-Based Detection
	- Behavior-Based Detection
	- Sandboxing


---
## Signature-Based Detection
- The antivirus software checks files against a database of known malware signatures (patterns unique to specific malware). If a match is found, the file is flagged as malicious.
- Ineffective against new or modified malware (zero-day threats). [Means UPDATE is MUST]
- Those Signatures Can be Used As Indicate Of Compromise (IOC) By Blue Teamers.

`md5sum file`

- virustotal.com website


---
## Behavior-Based Detection
- Analyzes [the behavior of programs] to identify suspicious activities that could indicate the presence of malware.
- Even if the exact signature isn't in the database, abnormal behavior (eg. modifying system files, connecting to known malicious) may trigger an alert.
- This may produce false positives by flagging legitimate software as suspicious.


---
## Sandboxing
- Runs suspicious programs in a controlled, isolated environment (a sandbox) to observe their behavior without affecting the system.
- if the program exhibits malicious behavior in the sandbox, it is flagged as [malware]
![[Pasted image 20250712213413.png]]


----
# Anti-Virus (AV) Evasion techniques
- There are some Techniques to Evade /Not being Detected by AV/
1. Packers
	- A packer is a program that [compresses an executable to make it smaller.]
	- It wraps the compressed executable in the code necessary to decompress itself at runtime.
	- Packing changes the signature hashes (we will learn on Day5 class), so the AV may not detect the packed file.
2. Crypters/encoders
	- The crypter encrypts the original executable using an encryption algorithm - often something as simple as a [XOR cipher] with a unique key.
	- Like a packer, its goal is to change the [binary fingerprint] of a file to avoid detection.
3. Polymorphic malware
	- Polymorphic malware changes its code with each infection, making each instance of the malware unique.
	- This helps it evade signature-based detection, as there is no consistent pattern for the antivirus to recognize.
4. Down-loaders And Droppers
	- Many kinds of malware use programs called droppers or down-loaders to learn about a system before installing the real malware.
	- Some of these droppers scope out a system first to avoid triggeting security alerts when they download and install the real payload.
5. Fileless Malware
	- Fileless malware operates entirely in memory, without writing any files to disk.
	- Since traditional antivirus software often focuses on scanning files, fileless malware can evade detection by avoiding the file system altogether.
	![[Pasted image 20250712214601.png]]

# Malware Prevention
1. Install anti-virus and anti-spyware software.
	a. Enable real-time scanning to detect threats early.
	b. Check for any Whitelisted Path/Directory
		Eg. kaspersky, avg, smadav
2. Keep AntiMalware Updated
3. Use secure authentication methods.
	a. 2-dactor authentication
	b. Implement email scurity and spam protection
4. Keep software updated
5. Use the least-privilage model.
6. Monitor for suspicious activity
7. Backup Strategy:
	Maintain resular, offline backups of critical data
	Test backups periodically to ensure reliability
8. Educate your users


-----
# Malware Attack Counter Measures
- Identify the Type of Malware:
	- Ransomware, file deletion, data corruption, or ex-filtration.
- Access Damage:
	- Determine what data has been encrypted, corrupted, or deleted.
- Immediately Disconnect Internet
- Run a Full System Scan with the Antivirus you have
- If you have any saved Passwords on your browser, try to change passwords of all the accounts.
- Try to Remove Any Background Running Program
	- you can do this Using task Manager
- Try to Remove Any Software you Installed Recently from suspicious place.
- Try to Remove Any document you copied to your system recently
- Check your Email if you got any suspicious Texts.

==================================================
==P2==
# Malware Attack Counter Measures
- Identify the Type of Malware:
	- Ransomware, file deletion, data corruption, or exfiltration.
- Access Damage:
	- Determine what data has been encrypted, corrupted, or deleted.
- Immediately Disconnect Internet
- Run a Full System Scan with the Antivirus you have
- If you have any saved passwords on your browser, try to change password of all the accounts.
- Try to remove Any Background running program
	- You can do this Using task Manager.
- Try to Remove Any software you installed Recently from suspicious Place
- Try to Remove Any document you Copies to Your system recently.
- Check you email if you got any suspicious texts.

## Data Recovery Steps
- Step 1: Restore from Backups:
	- Use the most recent unaffected backup to recover data.
	- Ensure backups are verified and clean before restoring
- Step 2: Use Recovery Tools:
	- Employ professional recovery tools for partially corrupted or deleted files.
	- Examples: Recuva, EaseUs Data Recovery, or enterprise-grade solutions.
- Step 3: Work with Vendors:
	- Engage backup and recovery solution vendors if specialized tools or expertise are needed.
- Step 4: Patch and Secure:
	- Update all systems and software to prevent a recurrence.

Address Ransomware-Specific Senarios
- Do Not Pay the Ransom:
	- Paying does not guarantee data recovery and may encourage further attacks.
- Use Decryption Tools:
	- Check for publicly available decryptors (eg. No More Ransom initiative)
- Contact Authorities:
	- Report the incident to local cybercrime agencies or CERTs.

## Malware in History
lets see some malwares that happened in history:
1. **Morris Worm**: also known as the internet worm, this was one of the [first computer worms] to spread via the Internet and earn notoriety in the media.
2. **ILOVEYOU**: The ILOVEYOU virus infected tens of millions of computer globally, resulting in billions on dollars in damage.
3. **Stuxnet**: Some experts believe this sophisticated worm was developed for years to launch a cyberattack.
4. **WannaCry**:  is a ransomeware which targeted computer running the Microsoft Windows operating system by encrypting (locking) data and demanding ransom payments in the Bitcoin cryptocurrency.


----
# Python for Malware development
- As we saw malwares do many things and we can develop that malware based on the algorithm, we need.
- First we have to understand what our malware have to do.
- There are many kinds of malware purpose
	- Delete files
	- Encrypt files
	- Corrupt files
	- ....
- Then you can convert your python file to executable(exe) by py2exe technics.

## Malware #1 - File deleting malware
- The algorithm is simple
	- when it load the program will delete files
		- The file being deleted is based on our plan, but if the file needs rot access then we need to build the rootkit too.
- For simplicity, i will show you making a simple python program that will delete files in a folder which it is opened.
- Lets create a test folder and our virus.py file
- Also let's create some random files for test.

## Starter
- Open your Vscode
- Import os package   `import os`
	- to run system commands
- Os package is a module that helps us to interact and do some Terminal commands because as you know python is not like bash and cant run shell commands directly.
- Example: 
```


```

Coding
- Make sure you run them in the right test folder.
- And go to that folder on your terminal/powershell.

![[Pasted image 20250714210639.png]]


## Result
- look 1st there were folders and files then boom after running our virus those files are removed.
- This is the main concept between some file viruses.
- ![[Pasted image 20250714211054.png]]

----
# File  Handling in python
- Files are names location on disk to sstore related information.
- Files used to store data in storage devices
- when we want to read from or write to a file,
	- we need to open it
	- and also when we are done we will close it
- In python, a file operation takes place in the following order:
	- Open a file
	- Read or Write (perform operation)
	- Close the file


- python has a built-in-function called open().
- Syntax:
	- with open("fileName or filePath", 'x') as var
- Modes:
	- write------------w
	- read-------------r
	- append----------a
	- create-----------x
	- text mode--------t
	- binary mode------b
- Example:
	- with open ("fileName", 'w') as var:
	- with open ("fileName", 'rt') as var: -> rt ~ r              -- text mode is default


## Write on files
- In order to write on file we have to open it in write, append, creation mode.
- Warning: be sure when yo use 'w' because it will verwrite the existing file. SO use Append 'a'.
- Syntax:
	- var.write ("Hello world")
![[Pasted image 20250714213314.png]]


## Reading files
- To read files on python we have to open it by reading mode 'r'
- There are many methods for this. But, we can use the read 
- read() -> This read file up to the inputted size number. BUT if you don't add the size it will read it until the end.
- readline() -> To read files

////////////

## Creating files
- You just need to add the x on the type.
- But be sure if the file exists there will be file exists error.
- To pass this use the following...
- 

## Checking existence
- To check if the file is created before:
- import os
- if os.path.exists("filename"):
	- print("The file already exist!")
- else:
	- print ("no file!")

----
# Malware Analysis
- Malware analysis is a process of analyzing malwares
- The purpose of malware analysis is usually to provide the information you need to respond to a network intrusion.
- Your goals will typically be to determine exactly what happened, and to ensure that you've located all infected machines and files.
- The Analysis is Done on the [Artifact/Sample].
	a. **Artifact**: is A Malware Sample Taken from an Infected System.
- Person who does The Analysis is called **Malware Analyst**


----
# Malware Analysis Techniques
- Most often, when performing malware analysis, you'll have only the malware executable, which won't be human-readable.
- In order to make sense of it, you'll use a variety of tools and tricks, each revealing a small amount of information.
- There are two fundamental approaches to malware analysis:
	- Static Analysis
	- Dynamic Analysis

## Static Analysis
- This is a method of analysig the Malware without Running.
- Based on the way we do this it is classified into the following:
	- Basic Static Analysis
	- Advanced Static Analysis

### A. Basic Static Analysis
- Basic static analysis consists of [examining the executable file without viewing the actual instructions].
- Basic static analysis can confirm whether a file is malicious, provide information about its functionality, and sometime provide information that will allow you to produce simple network signatures.
- Basic static analysis is straightforward and can be quick, but it's largely ineffective against sophisticated malware.
- Things Done
	- Antivirus Scanning
	- Getting the Signature of Malware
	- Checking if the Attacker used packer on it
	- Checking the signature on Different Scanning websites, like: VirusTotal 


VhybridirusTotal
- will check for files with Upload or Their Hash.
- Check for links, also hackers use it to get more information by searching Keywords when the Perform OSINT
- virustotal.com //////////////////////////////

Alternative
- Hybrid Analysis: This is a free malware analysis service for the community that detects and analyzes unknown threats using a unique Hybrid Analysis technology.
- https://


different red teaming malwares
	to check by uploading to virustotal
https://github.com/Flangvik/SharpCollection

### B. Advanced Static Analysis
- Advanced static analysis consists of [reverse-engineering] the malware's internals by loading the executable into a disassembler (Softwares for Reversing) and looking at the **program instruction** in order to discover what the program does.
- The instructions are executed by the CPU, so advanced static analysis tells you exactly what the program does.
- However, advanced static analysis has a steeper learning curve than basic static analysis and requires specialized knowledge of disassembly, code instructs, and Windows operating system concepts.
- Things Done:
	- Reverse Engineering the Malware, Understanding the Code.


so can we say advanced static analysis is about understanding the source code of the malware in simple terms

### Analysis of Vega Stealer
- The Vega Stealer payload was delivered via a document containing malicious macros.
- The document's lure and subsequent network activity is similar to other malicious documents and campaigns delivering payloads such as the banking Trojan Ursnif, but in this instance a newer form of macro was used.
- Vega Stealer is written in .NET and the sample we observed dropping in the wild did not contain any packing or obfuscation methods.
- One of the goals of Vega appears to be gathering and exfiltrating saved data from the Google Chrome Browsing//////////////////////////////////////////////


read 
https://www.proofpoint.com/us/blog/threat-insight/new-vega-stealer-shines-brightly-targeted-campaign

### Vega-Static Analysis
- When Blue teamers Analyze the Payload with "dotpeek"
- To learn more on .NET Reverse Engineering:
- ////////////////////////

Vega alsso takes a screenshot of ///////////////////////////

https://dogbolt.org/

----
## Dynamic Analysis
- Yjere is A Analyzing technique by Executing/Running the Malware.
- There are Two Kinds:
	- Basic Dynamic Analysis
	- Advanced Dynamic Analysis

### A. Basic Dynamic Analysis
- Basic dynamic analysis techniques involve running the malware and observing its behavior on the system in order to remove the infetion, produce effective
///////////////////

resolution limit


### B. Advanced Dynamic Analysis
- Advanced dynamic analysis uses a debugger to examine the internal state of a running malicious executable.
- Advanced dynamic analysis techniques provide another way to extract detailed information from an executable.
- ..................

Sysinternal

GNU core Utils
0 